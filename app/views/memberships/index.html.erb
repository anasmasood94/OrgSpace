<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>Members - <%= @organization.name %></h1>
  <div>
    <%= link_to "Add Member", new_organization_membership_path(@organization), class: "btn btn-primary" %>
    <%= link_to "Back", organization_path(@organization), class: "btn btn-secondary" %>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th>User</th>
            <th>Age</th>
            <th>Role</th>
            <th>Joined</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @memberships.each do |membership| %>
            <tr>
              <td><%= membership.user.email %></td>
              <td><%= membership.user.age %> years</td>
              <td><span class="badge bg-<%= membership.admin? ? 'success' : 'info' %>"><%= membership.member_type.humanize %></span></td>
              <td><%= membership.joined_at.strftime("%B %d, %Y") %></td>
              <td><span class="badge bg-<%= membership.active? ? 'success' : 'secondary' %>"><%= membership.status %></span></td>
              <td>
                <%= link_to "Edit", edit_organization_membership_path(@organization, membership), class: "btn btn-sm btn-outline-primary" %>
                <% if membership.user == current_user %>
                  <!-- No Remove button for self -->
                <% elsif membership.admin? %>
                  <%= button_tag "Remove", class: "btn btn-sm btn-outline-danger", disabled: true, title: "Cannot remove an admin member" %>
                <% else %>
                  <%= link_to "Remove", organization_membership_path(@organization, membership),
                      method: :delete,
                      data: { confirm: "Are you sure?" },
                      class: "btn btn-sm btn-outline-danger" %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
